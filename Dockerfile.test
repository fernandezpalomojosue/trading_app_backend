# =========================
# Dockerfile.test
# =========================
FROM python:3.12-slim

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=/app

# Dependencias para tests y psycopg2
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Instalar dependencias (app + tests)
COPY requirements.txt requirements-dev.txt ./
RUN pip install --no-cache-dir -r requirements.txt -r requirements-dev.txt

# Copiar código y tests
COPY app/ app/
COPY tests/ tests/
COPY pyproject.toml ./

# Ejecutar tests con configuración de pyproject.toml
CMD ["pytest", "-v", "--tb=short"]
